# Trigger on all branches, trigger:
trigger:
  batch: true
  branches:
    include:
      - '*'

# Set languages and operating system.
pool:
  vmImage: 'ubuntu-latest'
strategy:
  matrix:
    MATLAB 2020a:
      implementation_version: 'latest'

steps:
  - task: InstallMATLAB@0
    inputs:
      release: $(implementation_version)
    displayName: 'Use MATLAB $(implementation_version)'

  - task: UsePythonVersion@0
    inputs:
      versionSpec: 3.8

  - task: CmdLine@2
    name: Install Python Requirements
    inputs:
      script: |
        pip install numpy

  - task: CmdLine@2
    name: Fetch test-data
    inputs:
      script: |
        git config remote.origin.fetch refs/heads/*:refs/remotes/origin/*
        git fetch origin test-data
        git checkout origin/test-data -- extern/test-data
        git reset extern/test-data

  - task: RunMATLABTests@0
    displayName: 'Run MATLAB unit tests.'
    inputs:
      sourceFolder: 'brainstat_matlab'
